---
phase: 01-campaign-logs-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - terminal/data_loader.py
  - terminal/views.py
  - terminal/templates/terminal/shared_console_react.html
  - data/campaign/sessions/session-001.md
  - data/campaign/sessions/session-002.md
  - data/campaign/sessions/session-003.md
  - src/types/session.ts
autonomous: true

must_haves:
  truths:
    - "Session log data loads from markdown files in data/campaign/sessions/"
    - "Session data is available in window.INITIAL_DATA.sessions as a JSON array"
    - "Each session object contains session_number, date, title, location, npcs (array), and body (markdown string)"
    - "Sessions are sorted newest-first by session_number"
  artifacts:
    - path: "terminal/data_loader.py"
      provides: "load_sessions() and parse_session_file() methods"
      contains: "def load_sessions"
    - path: "terminal/views.py"
      provides: "sessions_json passed to template context"
      contains: "load_sessions"
    - path: "terminal/templates/terminal/shared_console_react.html"
      provides: "sessions data in INITIAL_DATA"
      contains: "sessions"
    - path: "src/types/session.ts"
      provides: "SessionLog TypeScript interface"
      exports: ["SessionLog"]
    - path: "data/campaign/sessions/session-001.md"
      provides: "Sample session log file"
    - path: "data/campaign/sessions/session-002.md"
      provides: "Sample session log file"
    - path: "data/campaign/sessions/session-003.md"
      provides: "Sample session log file"
  key_links:
    - from: "terminal/views.py"
      to: "terminal/data_loader.py"
      via: "loader.load_sessions() call"
      pattern: "loader\\.load_sessions\\(\\)"
    - from: "terminal/templates/terminal/shared_console_react.html"
      to: "terminal/views.py"
      via: "sessions_json template variable"
      pattern: "sessions.*safe"
---

<objective>
Add backend data pipeline for campaign session logs: DataLoader methods, Django view wiring, INITIAL_DATA injection, TypeScript types, and sample data files.

Purpose: Establish the data layer so the frontend LogsSection component (Plan 02) has session data available on page load.
Output: Session log data flowing from markdown files through Django to window.INITIAL_DATA.sessions.
</objective>

<execution_context>
@/home/gjohnson/.claude/get-shit-done/workflows/execute-plan.md
@/home/gjohnson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-campaign-logs-tab/01-CONTEXT.md
@.planning/phases/01-campaign-logs-tab/01-RESEARCH.md

Key source files to reference:
@terminal/data_loader.py — existing parse_message_file() and load_crew() patterns
@terminal/views.py — display_view_react() function where data is loaded
@terminal/templates/terminal/shared_console_react.html — INITIAL_DATA injection
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add load_sessions() to DataLoader and create sample session files</name>
  <files>
    terminal/data_loader.py
    data/campaign/sessions/session-001.md
    data/campaign/sessions/session-002.md
    data/campaign/sessions/session-003.md
  </files>
  <action>
Add two methods to the DataLoader class in terminal/data_loader.py:

1. `load_sessions(self) -> List[Dict[str, Any]]`:
   - Load all .md files from `self.data_dir / "campaign" / "sessions"`
   - Return empty list if directory doesn't exist
   - Parse each file using `parse_session_file()`
   - Normalize the `npcs` field: if it's a string, split by comma into a list; if missing, set to empty list
   - Normalize the `date` field: convert to string and take only the date part (split on space, take first element)
   - Sort by `session_number` descending (newest first)
   - Return the list of session dicts

2. `parse_session_file(self, session_file: Path) -> Dict[str, Any]`:
   - Follow the exact same pattern as the existing `parse_message_file()` method
   - Split on `---` delimiters to extract YAML frontmatter and markdown body
   - Return dict with `body` (markdown content), `filename` (file name), and all frontmatter fields spread in

YAML frontmatter schema for session files:
```yaml
session_number: 1
date: "2183-03-14"
title: "The Wake-Up Call"
location: "USCSS Morrigan"
npcs:
  - "Dr. Elena Vasquez"
  - "Captain Morrison"
```

Create the `data/campaign/sessions/` directory with 3 sample session files. Use the Mothership RPG sci-fi horror theme. Each file should have:
- YAML frontmatter with all fields (session_number, date, title, location, npcs)
- Markdown body with 2-3 paragraphs of narrative recap
- Use bold text and a subheading in at least one file to test markdown rendering
- Session numbers 1, 2, 3 with dates in ascending order (2183-03-14, 2183-03-21, 2183-03-28)

File naming: `session-001.md`, `session-002.md`, `session-003.md`
  </action>
  <verify>
Run: `python -c "from terminal.data_loader import DataLoader; loader = DataLoader(); sessions = loader.load_sessions(); print(f'Loaded {len(sessions)} sessions'); print(sessions[0].keys() if sessions else 'No sessions')"` — should print "Loaded 3 sessions" and show the expected keys.
  </verify>
  <done>DataLoader.load_sessions() returns 3 session objects sorted newest-first, each with session_number, date, title, location, npcs (list), body (string), and filename fields.</done>
</task>

<task type="auto">
  <name>Task 2: Wire session data into Django view and template, add TypeScript type</name>
  <files>
    terminal/views.py
    terminal/templates/terminal/shared_console_react.html
    src/types/session.ts
  </files>
  <action>
**terminal/views.py** — In the `display_view_react()` function, after the existing crew/npcs loading block:
- Call `loader.load_sessions()` to get sessions data
- Serialize to JSON with `json.dumps(sessions_data)`
- Add `'sessions_json': sessions_json` to the template context dict

**terminal/templates/terminal/shared_console_react.html** — In the `window.INITIAL_DATA` object:
- Add `sessions: {{ sessions_json|safe|default:'[]' }},` after the existing npcs line

**src/types/session.ts** — Create a new TypeScript type file:
```typescript
export interface SessionLog {
  session_number: number;
  date: string;
  title: string;
  location: string;
  npcs: string[];
  body: string;
  filename: string;
}
```

This type will be imported by the LogsSection component in Plan 02.
  </action>
  <verify>
1. Run Django server and visit http://127.0.0.1:8000/terminal/ — check page source for `window.INITIAL_DATA` containing `sessions` array with 3 session objects.
2. Run: `npx tsc --noEmit src/types/session.ts` — should pass with no errors.
  </verify>
  <done>Session data flows from DataLoader through Django view to window.INITIAL_DATA.sessions. TypeScript SessionLog interface exists for frontend consumption.</done>
</task>

</tasks>

<verification>
1. `python -c "from terminal.data_loader import DataLoader; loader = DataLoader(); sessions = loader.load_sessions(); assert len(sessions) == 3; assert sessions[0]['session_number'] == 3; assert isinstance(sessions[0]['npcs'], list); print('OK')"` — passes
2. Django template renders sessions in INITIAL_DATA (inspect page source)
3. `npx tsc --noEmit` — no TypeScript errors
</verification>

<success_criteria>
- 3 sample session markdown files exist in data/campaign/sessions/
- DataLoader.load_sessions() returns parsed, normalized session data sorted newest-first
- Django view passes sessions_json to template context
- window.INITIAL_DATA.sessions available in browser
- SessionLog TypeScript interface exported from src/types/session.ts
</success_criteria>

<output>
After completion, create `.planning/phases/01-campaign-logs-tab/01-01-SUMMARY.md`
</output>
