---
phase: 02-ship-status-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/gm/ShipStatusPanel.tsx
  - src/entries/GMConsole.tsx
  - src/services/gmConsoleApi.ts
autonomous: true

must_haves:
  truths:
    - "GM Console has a SHIP STATUS tab with controls for each system"
    - "GM can change any system's status to one of 5 states"
    - "Toggling a system state calls POST /api/gm/ship-status/toggle/"
    - "Current system states are displayed and update after toggle"
  artifacts:
    - path: "src/components/gm/ShipStatusPanel.tsx"
      provides: "GM controls for toggling ship system states"
      min_lines: 60
    - path: "src/services/gmConsoleApi.ts"
      provides: "toggleShipSystem() API method"
      contains: "toggleShipSystem"
  key_links:
    - from: "src/components/gm/ShipStatusPanel.tsx"
      to: "src/services/gmConsoleApi.ts"
      via: "gmConsoleApi.toggleShipSystem()"
      pattern: "toggleShipSystem"
    - from: "src/entries/GMConsole.tsx"
      to: "src/components/gm/ShipStatusPanel.tsx"
      via: "ShipStatusPanel component import"
      pattern: "ShipStatusPanel"
---

<objective>
Build GM Console controls for toggling ship system states — a new SHIP STATUS tab in the GM Console with dropdown selectors for each system's status.

Purpose: Enables the GM to change system states during gameplay, which players see via the STATUS bridge tab.
Output: ShipStatusPanel component integrated into GM Console tabs.
</objective>

<execution_context>
@/home/gjohnson/.claude/get-shit-done/workflows/execute-plan.md
@/home/gjohnson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ship-status-dashboard/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: ShipStatusPanel component and GM Console integration</name>
  <files>
    src/components/gm/ShipStatusPanel.tsx
    src/entries/GMConsole.tsx
    src/services/gmConsoleApi.ts
  </files>
  <action>
Read the existing EncounterPanel.tsx for the GM panel pattern (how it loads data, handles updates, uses Ant Design components).

Read src/services/gmConsoleApi.ts for the API service pattern.

**1. Add API method to gmConsoleApi.ts:**

Add a `toggleShipSystem` method and a `getShipStatus` method:
```typescript
async toggleShipSystem(system: string, status: string, condition?: number, info?: string) {
  const response = await axios.post('/api/gm/ship-status/toggle/', { system, status, condition, info });
  return response.data;
},

async getShipStatus() {
  const response = await axios.get('/api/ship-status/');
  return response.data;
},
```

**2. Create ShipStatusPanel.tsx:**

A GM Console panel that shows current ship system states and lets the GM toggle them.

Structure:
- Fetch current ship status on mount via `gmConsoleApi.getShipStatus()`
- Poll every 5 seconds to stay in sync (same pattern as EncounterPanel)
- For each of the 4 systems (Life Support, Engines, Weapons, Comms):
  - Display system name and current status
  - Ant Design `Select` dropdown with the 5 status options: ONLINE, STRESSED, DAMAGED, CRITICAL, OFFLINE
  - On select change: call `gmConsoleApi.toggleShipSystem(systemName, newStatus)`, then refresh data
  - Color the current status text to match the state (use inline style or className)
- Also show hull/armor current values as read-only info (not editable from GM Console in this phase)
- Show ship name at the top

Use Ant Design components: `Select`, `Typography`, `Space`, `Divider` as needed.
Follow the same styling approach as EncounterPanel — inline styles with dark theme colors.

**3. Integrate into GMConsole.tsx:**

Add a new tab to the Tabs component in GMConsole. Use the `DashboardOutlined` icon from `@ant-design/icons`.

```typescript
import { DashboardOutlined } from '@ant-design/icons';
import { ShipStatusPanel } from '@/components/gm/ShipStatusPanel';
```

Add as a new tab item (between ENCOUNTER and BROADCAST tabs):
```typescript
{
  key: 'ship-status',
  label: (
    <span>
      <DashboardOutlined style={{ marginRight: 8 }} />
      SHIP STATUS
    </span>
  ),
  children: (
    <div style={{ ... same wrapper styling as other tabs ... }}>
      <ShipStatusPanel />
    </div>
  ),
},
```
  </action>
  <verify>
Run: `npx tsc --noEmit` — no TypeScript errors.
Run: `npm run build` — successful production build.
Visually: Open GM Console, click SHIP STATUS tab, see 4 systems with dropdown selectors. Change a system status, observe the dropdown updates. Check terminal STATUS tab reflects the change within 3 seconds.
  </verify>
  <done>GM Console has SHIP STATUS tab. Each of 4 systems shows current status with dropdown selector. Selecting a new status calls the toggle API. Ship name and hull/armor info displayed as read-only. TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. GM Console shows SHIP STATUS tab with 4 system controls
4. Changing a system status via dropdown calls POST /api/gm/ship-status/toggle/
5. Terminal STATUS tab picks up the change within 3 seconds
</verification>

<success_criteria>
- SHIP STATUS tab appears in GM Console between ENCOUNTER and BROADCAST tabs
- All 4 systems (Life Support, Engines, Weapons, Comms) have dropdown selectors
- Dropdown options include: ONLINE, STRESSED, DAMAGED, CRITICAL, OFFLINE
- Selecting a new status calls the API and updates the display
- Ship name shown at top of panel
- Hull/armor values displayed as read-only info
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-ship-status-dashboard/02-03-SUMMARY.md`
</output>
