{% load static %}
<li class="tree-item">
    <!-- Location Row -->
    <div class="location-row {% if active_view.location_slug == location.slug and active_view.view_type == 'ENCOUNTER_MAP' %}displaying{% endif %}">

        <div class="location-content" onclick="toggleTreeItem('{{ location.slug }}');">
            <!-- Toggle triangle for expand/collapse -->
            <span class="tree-toggle {% if not location.children and not location.terminals %}empty{% endif %}"
                  id="toggle-{{ location.slug }}">
                {% if location.children or location.terminals %}&#9654;{% endif %}
            </span>

            <!-- Location name -->
            <span class="location-name">{{ location.name|upper }}</span>
        </div>

        <!-- Display button -->
        <div class="display-btn-container {% if active_view.location_slug == location.slug and active_view.view_type == 'ENCOUNTER_MAP' %}active{% endif %}"
             onclick="event.stopPropagation(); displayLocation('{{ location.slug }}');">
            <span class="display-btn-icon">&#128065;</span>
        </div>
    </div>

    <!-- Child Locations (recursive) -->
    {% if location.children %}
    <ul class="location-children" id="children-{{ location.slug }}">
        {% for child in location.children %}
            {% include 'terminal/tree_location.html' with location=child depth=depth|add:1 %}
        {% endfor %}
    </ul>
    {% endif %}

    <!-- Terminals for this location -->
    {% if location.terminals %}
    <ul class="terminal-list" id="terminals-{{ location.slug }}">
        {% for terminal in location.terminals %}
        <li class="tree-item">
            <div class="terminal-row">

                <div class="terminal-content">
                    <span class="tree-toggle empty"></span>
                    <span class="terminal-name">{{ terminal.terminal_id|default:terminal.slug|upper }}</span>
                    <span class="terminal-owner">{{ terminal.owner }}</span>
                </div>

                <!-- Show button -->
                <div class="show-btn-container"
                     id="show-{{ location.slug }}-{{ terminal.slug }}"
                     onclick="event.stopPropagation(); showTerminal('{{ location.slug }}', '{{ terminal.slug }}', this);">
                    <span class="show-btn-icon">&#9658;</span>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
</li>
