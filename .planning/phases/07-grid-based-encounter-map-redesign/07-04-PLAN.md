---
phase: 07-grid-based-encounter-map-redesign
plan: 04
type: execute
wave: 3
depends_on: [07-02, 07-03]
files_modified: []
autonomous: false
requirements: [GRID-10]

must_haves:
  truths:
    - "Grid map renders rooms as touching wall-aligned cells with amber walls"
    - "Background void shows faint dark grid lines"
    - "Room interiors show subtle scanline texture distinct from void"
    - "Room labels appear only in revealed rooms, centered, not shown for corridors"
    - "Tokens can be placed and moved in multi-rect rooms including alcoves"
    - "GM clicking a room on the map toggles its reveal/hide state"
    - "Reveal all / hide all bulk buttons work in EncounterPanel sidebar"
    - "Hidden rooms: dimmed in GM view, completely absent in player terminal view"
    - "Door symbols appear on wall edges in correct positions"
  artifacts: []
  key_links: []
---

<objective>
Human verification of the complete grid-based encounter map redesign.

Purpose: Visual and interactive confirmation that the grid renderer, room reveal mechanics, token placement, and GM controls all work correctly together end-to-end.
Output: GM and user confirm all acceptance criteria pass; any failures logged for gap closure.
</objective>

<execution_context>
@/home/gjohnson/.claude/get-shit-done/workflows/execute-plan.md
@/home/gjohnson/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify grid-based encounter map end-to-end</name>
  <action>Human verification — see how-to-verify below for step-by-step test scenarios</action>
  <verify>Human confirms all 6 test scenarios pass (visual rendering, room reveal, player terminal, doors, token multi-rect, room list)</verify>
  <done>All 6 tests pass: grid render with amber walls, GM click-to-reveal, bulk reveal/hide, player terminal hides rooms, tokens in alcoves, no status badges in room list</done>
  <what-built>
Complete grid-based encounter map redesign:
- New TypeScript types (GridRect, GridRoom, DoorDef, GridEncounterMapData, isGridEncounterMap)
- Three YAML maps rebuilt in grid format (deck_1, deck_2, main_facility)
- EncounterMapRenderer rewritten with wall-segment algorithm, scanline floor texture, background grid, GM click-to-reveal
- EncounterMapDisplay routes grid maps to new renderer
- TokenLayer handles multi-rect rooms in findRoomAtCell
- MapPreview delegates grid maps to EncounterMapRenderer with onRoomToggle
- EncounterPanel room list shows type badge instead of status badge; bulk reveal/hide buttons added; onRoomToggle wired to MapPreview
  </what-built>
  <how-to-verify>
Start the development servers:
```bash
cd /home/gjohnson/mothership/charon
python manage.py runserver &
npm run dev &
```

**Test 1: Visual rendering (GM Console)**
1. Open http://127.0.0.1:8000/gmconsole/
2. Navigate to USCSS Morrigan encounter (ENCOUNTER view)
3. Confirm:
   - Rooms appear as touching boxes with amber wall lines (no floating boxes)
   - Background shows faint dark grid in the void between/around rooms
   - Room interiors show subtle scanline texture (distinguishable from void)
   - Room labels are centered in each room

**Test 2: Room visibility (GM Console)**
4. In EncounterPanel sidebar, click "HIDE ALL" — all rooms should become hidden
5. Confirm GM map view dims all rooms (rooms still visible but at ~25% opacity)
6. Click directly on a room in the MAP PREVIEW — it should reveal (highlight to full opacity)
7. Click a revealed room — it should hide again (dim)
8. Click "REVEAL ALL" — all rooms should return to full opacity

**Test 3: Player terminal visibility**
9. Open http://127.0.0.1:8000/terminal/ in a second window
10. Set encounter view via GM console (ensure USCSS Morrigan deck_1 is active)
11. With some rooms hidden: confirm player terminal shows ONLY revealed rooms (hidden rooms = pure void, not dimmed)
12. Toggle a room visible from GM console — within ~2 seconds, player terminal should show the newly revealed room

**Test 4: Door symbols**
13. Confirm door symbols appear on wall edges (not floating in void between rooms)
14. Different door types should show different visual styles (blast_door = X icon, airlock = double border, etc.)

**Test 5: Token placement in multi-rect rooms**
15. Place a token on the main area of the Cargo Bay (or Equipment Bay in main_facility if testing that map)
16. Try placing a token in the alcove rect of an L-shaped room
17. Confirm token is accepted (not rejected as "outside room")
18. Move the token — confirm drag-to-move works in both rects of the room

**Test 6: Room list in EncounterPanel**
19. Check the ROOM VISIBILITY section in EncounterPanel
20. Confirm: no status badges ([HAZARD], [WARNING], etc.) — only room names
21. If rooms have a `type` field (e.g. bridge, cargo), confirm the type tag appears (optional)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe which tests failed and what behavior was observed.</resume-signal>
</task>

</tasks>

<verification>
N/A — this is a human verification plan. Success is the human typing "approved".
</verification>

<success_criteria>
Human types "approved" after confirming:
- Grid map renders with amber walls, scanline floor, background grid
- GM click-to-reveal works on map and in sidebar list
- Bulk reveal/hide works
- Player terminal shows/hides rooms correctly
- Token placement works in L-shaped room alcoves
- Door symbols on wall edges, correct visual styles
</success_criteria>

<output>
After completion, create `.planning/phases/07-grid-based-encounter-map-redesign/07-04-SUMMARY.md`
</output>
